%% analyse.tex
%% $Id: analyse.tex 28 2007-01-18 16:31:32Z bless $

\chapter{Schlafanalyse}
\label{ch:sa}

\section{Earable Plattform}
\label{ch:sa:ep}
Zur Erfassung der Daten werden eSense-Earpods der Firma ``Nokia Bell Labs Cambridge'' verwendet.	
Es ist ein Mikrofon und Lautsprecher verbaut, welche beide über Bluetooth angebunden werden können. 
Des weiteren ist das für diese Bachelorarbeit interessanteste Element, eine 6-Achsen IMU (Inertial Motion Unit) enthalten.
Eine IMU ist eine inertiale Messeinheit, womit Gyroskop- und Beschleunigungsdaten aufgezeichnet und mittels BLE (Bluetooth Low Energy) auf das Smartphone übertragen werden können. 
Es handelt sich um einen 3-Achsen Beschleunigungssensor, sowie einen 3-Achsen Gyroskop.
Die Messrate dieser Sensoren ist variabel einstellbar, wurde im folgenden auf $50 \si{\hertz}$ festgelegt.

\todo{Beschreibe noch die Filter, die auf die Daten angewandt werden per Default... steht in der Doku des eSense Kopfhörers}

\todo{import picture of esense earpods}

\todo{soll ich hier schreiben, dass die Kopfhörer noch nicht im Handel sind?}

\todo{Welche Vor-/Nachteile gibt es diese zu nutzen? Was soll auf genommen werden?}

\subsection{Was wird aufgezeichnet?}
\label{ch:sa:ep:what_to_record}
Zu vollständigen Aufzeichnung eines Datensatzes werden die IMU-Daten, welche via BLE auf das Smartphone übertragen werden, in einer Datenbank abgespeichert.
Insgesamt werden hierbei pro empfangene Dateneinheit 6 Werte persistiert, die \textit{x, y} und \textit{z} Richtung vom Beschleunigungssensor, bzw vom Gyroskop. 
Des weiteren wird die aktuelle Zeit, die aktuell auszuführende Aktion des Studienablaufs und die Information, ob die LED des Smartphones an oder aus ist, zu jeder empfangenen Dateneinheit hinzugefügt.
Das Mikrofon wird ebenfalls aufgezeichnet und nach der Messsung abgespeichert.
Vor dem Beginn einer Messung wird der Studienteilnehmer gebeten, ein paar Zusatzinformationen (siehe \ref{ch:sa:additionalUserStudiesInformation}) anzugeben.
Diese werden vor dem Start der Messung am Smartphone ausgefüllt und ebenfalls in der Datenbank gespeichert.

\subsection{Datenexport}
\label{ch:sa:ep:export}
Zur weiteren Verarbeitung werden die Daten, nachdem sie von der App lokal in einer Datenbank gespeichert werden, exportiert. 
Zuerst werden die Datenbankeinträge der aktuellen Messung als \textit{csv}-Datei exportiert und in einem temporären Ordner abgespeichert.
Hierbei werden die Gyroskop einträge separat von den Beschleunigungsdaten exportiert, es entstehen folglich 2 \textit{csv}-Dateien (\glqq \textit{GyroData\_\$ID\$.csv}\grqq, \glqq \textit{ACCData\_\$ID\$.csv}\grqq).
Das Mikrofon-Signal wird nach der Messung als \textit{m4a}-Datei ebenfalls im temporären Ordner abgelegt.
Die Zusatzinformationen, welche über den Studienteilnehmer hinterlegt wurden, werden als \textit{csv}-Datei (\glqq \textit{UserStudyPersonDetails\_\$ID\$.csv}\grqq) ebenfalls in den temporären Ordner persistiert.
Alle Dateien des temporären Ordners werden in einer zip-Datei verpackt und können über den Share-Screen von Apple über verschiedene Wege geteilt werden.

\section{Polysomnographie-Systeme}
\label{ch:sa:psg}
Als Referenz zu den eSense-Earpods wird ein Polysomnographie-System (PSG-System) verwendet. 
Ein solches System zeichnet Messungen für physiologische Funktionen des Körpers währrend des Schlafs auf und kann somit mögliche Schlafstörungen diagnostizieren.
Es werden kontinuierlich verschiedene Körperfunktionen überwacht, wodurch nach einer Messung ein umfangreiches und individuelles Schlafprofil erstellt werden kann.

Das Polysomnographie-System zeichnet währrend der Studie ebenfalls Daten auf und soll die Resultate, welche durch die eSense-Earpods gesammelt und analysiert werden, verifizieren. Somit dienen die Daten, welche durch das PSG-System gesammelt werden, als \glqq Ground-Truth\grqq.

\todo{erkläre, wie man das PSG-System konfigurieren kann, dass es ein programm gibt, wo man eine Montage definieren kann, was ich gewählt habe, warum}

Im folgenden werden alle Sensoren aufgelistet, welche für die Studie aufgezeichnet wurden. Die nicht persistierten Daten werden im folgenden ignoriert.

\todo{übersetze tabelle und erkläre, was die sachen sind, wo sie genau gemessen werden, Licht dient als referenz}

\begin{itemize}
    \item Abdomen
    \item \textbf{Lichtsignal ($128 \si{\hertz}$)}: Am PSG-System befindet sich ein Lichtsensor. Wird verwendet um die Signale von PSG-System und den eSense-Earpods zu synchronisieren
    \item Flow
    \item Movement
    \item Pleth
    \item Pulse
    \item Schnarch
    \item Spo2
    \item Thorax
    \item ThoraxAbdomen
    \item edfAnnotations
\end{itemize}

\subsection{Datenexport}
\label{ch:sa:psg:export}

Im PSG-System befindet sich eine CF-Karte (\textit{Compact-Flash}). Diese kann mihilfe der vom PSG-System bereitgestellten Software \glqq \todo{inser Name of software}\grqq ausgelesen werden.
Die Software stellt eine Ansicht dar, womit man die Signale untereinander in einer Timeline betrachten kann. Die aufgezeichneten Signale können als \textit{edf}-Datei exportiert werden.
Mittels Python kann man \textit{edf}-Dateien auslesen und weiterverarbeiten.
Pro Studie wurden alle 3 Positionsabläufe in einem einzigen Messvorgang aufgezeichnet. Somit müssen die 3 Einzelmessugen aus der \textit{edf}-Datei herausgezogen werden.
Für weitere Details siehe Kapitel \ref{ch:impl} \todo{change ref to ref, where edf-analyzation is explained}

\section{Kamera}
\label{ch:sa:camera}
\todo{describe the camera usage}

\section{Datensynchronisation}
\label{ch:sa:data_synchronisation}
\todo{Beschreibe, wie die Daten synchron abgestimmt wurden}
Um sicherzugehen, dass das PSG-System, sowie die Daten der eSense-Earpods zeitlich exakt übereinstimmt, wurden mit der App kurze Lichtblitze gesendet ($20 \si{\ms}$).
Durch einen 3D-Drucker wurde eine Vorrichtung angefertigt, welche das Smartphone auf das PSG-System platziert, sodass die Lichtblitze direkt auf den Lichtsensor zeigen.
\todo{insert pic from 3D-Printing}
Die Lichtblitze lösen nach jeder Aktionsänderung aus, die der Studienteilnehmer erhält. 
Den genauen Ablauf der Lichtblitze kann man dem Kapitel \ref{testref} entnehmen.
Die Lichtblitze der Messung können nun mit den Lichtblitzen der eSense-Daten synchronisiert werden (siehe \ref{testref} \todo{insert ref}).

\section{Zusatzinformationen der Nutzer}
\label{ch:sa:additionalUserStudiesInformation}
Vor dem Start der Datenaufzeichnung wurden Informationen über die Aufzeichnung und über den Teilnehmer gesammelt. 
Dies soll lediglich dazu dienen, spätere Unklarheiten im Datensatz erklären zu können.
Es werden Informationen zum Körper der Person abgefragt (Alter, Größe, Gewicht, Geschlecht, Schlafrhythmus), den Earpodaufsatz, die Matratzenart, sowie Maße des Ohrs.

\todo{Beschreibe, welche Daten aufgezeichnet wurden, jedoch mit beschreiben, dass sie nur da sind, falls was erkannt und bestätigt wernden sollte, wie z.B dass jmd krasser geatmet hat weil er dick ist, oder so...}

\section{Maschinelle Lernverfahren}
\label{ch:sa:machine_learning}
\begin{itemize}
    \item Welche maschinellen Lernverfahren kommen in Frage?
    \item WelcheVor-undNachteilekönnendieseVerfahrenbieten? 
    \item WiemüssenDatenaufbereitetwerden?
\end{itemize}

Klassifikation der Daten
\begin{itemize}
    \item Random Forest
    \item SVM
\end{itemize}

Was bieten die beiden verfahren, wie macht das sinn, dass sinnvolle ergebnisse herauskommen...

\subsection{Datenaufbreitung für Klassifikation}
\label{ch:sa:machine_learning:data_handling}

5 sec zeitschlitze, welche immer um 1 sec verschoben sind

feature extractor tsfresh auf 5 sec zeitintervall angewandt...
